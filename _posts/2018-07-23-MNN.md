---
title: 通过匹配共同最近邻居校正 scRNA-seq 数据中的批次效应
description: 
categories:
 - scRNA-seq
tags:
 - paper
 - scRNA-seq
 - method
 - batch effects
---

大型 scRNA-seq 数据集包含来自不同时间点，不同实验室得到的数据，其中存在的批次效应可能干扰数据的整合和解释。现有的 scRNA-seq 分析技术错误地假设不同批次细胞群的组成是已知的或相同的，为此，本文献中作者提出了一种从高维表达谱数据中寻找共同最近邻居（mutual nearest neighbors, MNNs）进行批次效应校正的策略。该方法不依赖先前所提及的假设，只需批次之间存在共享的群体。不管是在模拟数据还是真实数据中，该方法表现均更加优秀

<!-- more -->

# Introduction  
大型研究往往包含来自不同实验室的数据，这些数据是在不同操作者，不同时间点，不同操作流程等情况下获取的，可能导致存在批次效应，使得某一批数据中基因表达情况与另一批次的数据存在系统性的差异。这样的差异可能会掩盖背后真正的生物学原因，因此需要在后续分析之前进行校正。  
大部分现有的方法进行批次效应校正时都是基于线性回归的，而且多是针对 bulk 数据，因此，将它们用于 scRNA-seq 数据是假设各批次细胞群体组成是一致的，批次间存在的系统性差异都被归为技术差异，可以被剔除。但实际上，不同批次细胞组成往往不一致，因此对批次区块因素估计的系数不仅仅是技术层面的，还包括生物学层面的。基于这些系数进行批次效应的校正将会得到错误的细胞表达谱，最终得到的结果可能还不如不校正。  
另一种方法是从一个参考数据集中选取一组标志，从而将新的数据映射至参考数据集上。其基本原理是认为对于参考数据集中的某一细胞类型，在新的批次中与之最相似的应该是同一类型的细胞。该映射策略可以通过 PCA，传播图（diffusion maps），t-SNE 等实施，需要从参考数据集高维空间中选取能够覆盖之后所有批次细胞类型的标志点。因此，假如新的批次中出现了新的细胞类型，这些细胞类型就没法映射至由标志点定义的空间中的正确位置。  
作者提出了一种新的方法，能够基于批次间的 MNN 移除生物学相关的批次间差异。这些 MNN 被认为是批次间同一细胞类型中最相似的细胞，这些细胞间的差异使得我们能够估算批次效应，得到批次效应的校正向量，从而应用于细胞表达数据进行批次校正。该方法能够自动识别批次间群体组成的重叠部分，且仅利用该部分进行校正。  
  
# 匹配相互最近邻居进行批次校正  
新方法寻找不同试验批次或重复之间具有相互类似表达谱的细胞，认为这些细胞之间的差异是由批次效应导致的，而不涉及背后所感兴趣的生物学因素。另外，该定义将一些不感兴趣的生物学特征轨道了批次效应中。  
第一步，通过余弦归一化对数据进行缩放，如 Y<sub>x</sub> 表示细胞 x 的表达向量，则标准化结果为 Y<sub>x</sub>/||Y<sub>x</sub>||，然后计算细胞对之间的欧几里得距离。整个过程相当于计算原表达向量之间的余弦距离。余弦距离广泛用于衡量细胞之间的相似性，且与标度无关，面对批次间测量深度和捕获效率的差异都表现出足够的鲁棒性。  
第二步是鉴定相互最近邻居。设想某个 scRNA-seq 实验包含两个批次：batch1 和 batch2。对于批次1中的每个细胞 i<sub>1</sub>，在批次2中存在 k 个细胞与之有着相同的最小距离，即在批次2中有 k 个最近邻居。同样，对批次2中的每个细胞，找出其在批次1中的最近邻居。如果各批次间的一对细胞分别包含于对方的最近邻居集中，我们称这对细胞为相互最近邻居，认为它们是同一细胞类型或者处于同一状态。
最后，就是比较 MNN 对细胞间表达水平的差异，即代表批次效应。  
整个方法有以下3个假设：  
1. 批次之间至少有一类细胞是同时出现的；  
2. 批次效应与生物学亚空间之间基本是正交的；  
3. 不同类型细胞之间的批次效应差异远小于生物学差异  

生物学亚空间指的是一组代表生物学过程的基础向量，比如表示细胞周期的，表示特定细胞类型的等。向量长度与基因数一致，每个细胞的表达谱就是这些向量的线性总和。批次效应也通过等长的向量表示，加到各细胞表达谱上去。在上述假设情况下，不同批次的同一细胞群之间会形成平行的超平面。另外，对于高维数据中随机某个一维的批次效应向量，正交假设很弱，特别是考虑到局部生物学空间本征维数通常远低于数据集中基因总数。  
对于每对 MNN，计算细胞之间的表达谱差异得到 MNN 对特异性批次校正向量。虽然一组生物学相关基因（如变化差异大的基因）有利于 MNN 的鉴定，但批次向量的计算并不是非得处于同一空间。因此，我们可以通过不同的基因组合计算批次向量，然后根据高斯核加权平均得到每个细胞特异性的批次校正向量，使各细胞的校正平稳进行，确保高维表达空间内相邻细胞平滑地变化。批次向量的高斯平滑得到局部的线性批次校正，使得每对 MNN 的批次向量对
